rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function to check if user is admin
    function isAdmin() {
      return request.auth != null && 
             request.auth.token.email == 'adminannektech@gmail.com';
    }
    
    // Content collection rules
    match /content/{document=**} {
      allow read: if true;  // Anyone can view content
      allow create, delete: if isAdmin();  // Only admin can create/delete content
      allow update: if isAdmin() || 
                      (request.resource.data.diff(resource.data).affectedKeys().hasOnly(['likes', 'shares', 'comments', 'views', 'lastViewed']));  // Allow anyone to update engagement metrics only
    }
    
    // Media collection rules
    match /media/{document=**} {
      allow read: if true;  // Anyone can view media
      allow write: if isAdmin();  // Only admin can upload/delete media
    }
    
    // Dashboard-related collections
    match /stats/{document=**} {
      allow read: if true;  // Anyone can view stats
      allow write: if isAdmin();  // Only admin can update stats
    }
    
    match /traffic/{document=**} {
      allow read: if true;  // Anyone can view traffic data
      allow write: if isAdmin();  // Only admin can update traffic data
    }
    
    match /pageViews/{document=**} {
      allow read: if true;  // Anyone can view page views
      allow write: if isAdmin();  // Only admin can update page views
    }
    
    match /activity/{document=**} {
      allow read: if true;  // Anyone can view activity
      allow write: if isAdmin();  // Only admin can add/update activity
    }
    
    // Messages collection rules
    match /messages/{messageId} {
      allow create: if true;  // Anyone can submit a message
      allow read, update, delete: if isAdmin();  // Only admin can manage messages
    }
    
    // Blog collection rules
    match /blog/{document=**} {
      allow read: if true;  // Anyone can view published blog posts
      allow write: if isAdmin();  // Only admin can create/edit/delete blog posts
    }
    
    // Default rule - deny everything else
    match /{document=**} {
      allow read, write: if false;
    }
  }
} 